nb: many bugs still to work out

